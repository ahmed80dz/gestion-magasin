class ProduitsController < ApplicationController
  # GET /produits
  # GET /produits.xml
  def index
    @produits =  @produits = Produit.all :order => "created_at DESC"
    @produit = Produit.new
    respond_to do |format|
      format.html # index.html.erb
    end
  end

  # GET /produits/1
  # GET /produits/1.xml
  def show
    @produit = Produit.find(params[:id])

    respond_to do |format|
      format.html # show.html.erb
      format.xml  { render :xml => @produit }
    end
  end

  # GET /produits/new
  # GET /produits/new.xml
  def new
    @produit = Produit.new

   # respond_to do |format|
  #    format.html # new.html.erb
  #    format.xml  { render :xml => @produit }
  #  end
  end

  # GET /produits/1/edit
  def edit
    @produit = Produit.find(params[:id])
  end

  # POST /produits
  # POST /produits.xml
  def create
    @produit = Produit.new(params[:produit])
      if @produit.save
         @produits = Produit.all :order => "created_at DESC"
        flash[:notice] = 'Produit was successfully created.'
      end
  end

  # PUT /produits/1
  # PUT /produits/1.xml
  def update
    @produit = Produit.find(params[:id])
    @produit.update_attributes(params[:produit])
     @produits = Produit.all :order => "created_at DESC"
  end

  # DELETE /produits/1
  # DELETE /produits/1.xml
  def destroy
    @produit = Produit.find(params[:id])
    @produit.destroy
    flash[:notice] = "Prouduit efface."
  end
  require 'csv'
  def csv_import
    n=0
    CSV.foreach(params[:dump][:file], :col_sep =>';') do |row|
      c=Produit.new
     n=n+1
      c.ref=row[1]
     c.nom=row[5]
     c.prix=row[8]
     c.save
    end
    flash.now[:message]="CSV Import Successfuly ,#{n} new records added to data base"
     @produits = Produit.all
    render :action => "index"
  end

end
